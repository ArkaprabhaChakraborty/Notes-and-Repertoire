---
description: A basic primer on NetBIOS enumeration and exploitation
---

# NetBIOS Pentest

Attackers use the NetBIOS enumeration to obtain:&#x20;

* The list of computers that belong to a domain&#x20;
* The list of shares on the individual hosts in the network&#x20;
* Policies and passwords

## Enumeration

### Using `nbtstat` utility in Windows

The `nbtstat` utility in Windows displays NetBIOS over TCP/IP (NetBT) protocol statistics, NetBIOS name tables for both the local and remote computers, and the NetBIOS name cache.

#### Get the NetBIOS name table of a remote computer

Using the -a flag all the records in the NetBIOS name list using the remote hostname or NetBIOS name of the computer/target in the NetBIOS network.

```
nbtstat -a <Remote Name>
```

Using the `-A` flag we can dump all records in the NetBIOS name list using the IP address of the target. It can be used interchangeably with the `-a` flag.

```
nbtstat -A <IP Address>
```

<figure><img src="../../.gitbook/assets/image (28).png" alt=""><figcaption></figcaption></figure>

The common NetBIOS Codes are:

<table><thead><tr><th width="134">Name</th><th width="152">NetBIOS Code</th><th width="102">Type</th><th>Information Obtained</th></tr></thead><tbody><tr><td>&#x3C;host name></td><td>&#x3C;00></td><td>UNIQUE</td><td>Hostname</td></tr><tr><td>&#x3C;domain></td><td>&#x3C;00></td><td>GROUP</td><td>Domain name</td></tr><tr><td>&#x3C;host name></td><td>&#x3C;03></td><td>UNIQUE</td><td>Messenger service running for the computer</td></tr><tr><td>&#x3C;user name></td><td>&#x3C;03></td><td>UNIQUE</td><td>Messenger service running for the logged-in user</td></tr><tr><td>&#x3C;host name></td><td>&#x3C;20></td><td>UNIQUE</td><td>Server service running</td></tr><tr><td>&#x3C;domain></td><td>&#x3C;1D></td><td>GROUP</td><td>Master browser name for the subnet</td></tr><tr><td>&#x3C;domain></td><td>&#x3C;1B></td><td>UNIQUE</td><td>Domain master browser name, which identifies the primary domain controller (PDC) for the domain</td></tr><tr><td>&#x3C;domain></td><td>&#x3C;1E></td><td>GROUP</td><td>Browser service elections</td></tr></tbody></table>

#### Fetch the contents/names in NetBIOS name cache&#x20;

```
nbtstat -c
```

<figure><img src="../../.gitbook/assets/image (29).png" alt=""><figcaption></figcaption></figure>

#### Display the names registered locally&#x20;

The `-n` flag displays the names registered locally by NetBIOS applications such as the server and redirector.

```
nbtstat -n
```

<figure><img src="../../.gitbook/assets/image (31).png" alt=""><figcaption></figcaption></figure>

#### Count of all names resolved by a broadcast or WINS server

```
nbtstat -r
```

<figure><img src="../../.gitbook/assets/image (32).png" alt=""><figcaption></figcaption></figure>

#### Purges the name cache and reloads all `#PRE`-tagged entries from the `Lmhosts` file

```
nbtstat -R 
```

#### Release and re-register all names with the name server

```
nbtstat -RR
```

#### List the NetBIOS sessions

List the current NetBIOS sessions and their status with the IP addresses

```
nbtstat -S
```

List the NetBIOS sessions table converting destination IP addresses to computer NetBIOS names

```
nbtstat -s
```

Re-displays selected statistics, pausing at each display for the number of seconds specified in the interval

```
nbtstat Interval
```

### Using `nmap` scripts

The nbstat. nse script can be used for NetBIOS enumeration

```
nmap -sV -v --script nbstat.nse <target IP address>
```

```
Starting Nmap 7.92 ( https://nmap.org ) at 2023-12-03 06:43 EST
Stats: 0:00:07 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan
Service scan Timing: About 17.65% done; ETC: 06:43 (0:00:28 remaining)
Nmap scan report for 10.10.1.22
Host is up (0.066s latency).
Not shown: 983 closed tcp ports (reset)
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
80/tcp   open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2023-12-03 18:43:30Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: CEH.com0., Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds  Microsoft Windows Server 2008 R2 - 2012 microsoft-ds (workgroup: CEH)
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
1801/tcp open  msmq?
2103/tcp open  msrpc         Microsoft Windows RPC
2105/tcp open  msrpc         Microsoft Windows RPC
2107/tcp open  msrpc         Microsoft Windows RPC
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: CEH.com0., Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
3389/tcp open  ms-wbt-server Microsoft Terminal Services
MAC Address: 08:62:75:78:00:6E (Unknown)
Service Info: Host: SERVER2022; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| nbstat: NetBIOS name: SERVER2022, NetBIOS user: <unknown>, NetBIOS MAC: 08:62:75:78:00:6e (unknown)
| Names:
|   SERVER2022<00>       Flags: <unique><active>
|   CEH<00>              Flags: <group><active>
|   CEH<1c>              Flags: <group><active>
|   SERVER2022<20>       Flags: <unique><active>
|   CEH<1e>              Flags: <group><active>
|   CEH<1b>              Flags: <unique><active>
|   CEH<1d>              Flags: <unique><active>
|_  \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 55.53 seconds

```

```
sudo nmap -sV -sU --script nbstat.nse 10.10.1.22 -p 137
```

```
Starting Nmap 7.92 ( https://nmap.org ) at 2023-12-03 07:05 EST
Nmap scan report for 10.10.1.22
Host is up (0.00082s latency).

PORT    STATE SERVICE    VERSION
137/udp open  netbios-ns Microsoft Windows netbios-ns (Domain controller: CEH)
MAC Address: 08:62:75:78:00:6E (Unknown)
Service Info: Host: SERVER2022; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| nbstat: NetBIOS name: SERVER2022, NetBIOS user: <unknown>, NetBIOS MAC: 08:62:75:78:00:6e (unknown)
| Names:
|   SERVER2022<00>       Flags: <unique><active>
|   CEH<00>              Flags: <group><active>
|   CEH<1c>              Flags: <group><active>
|   SERVER2022<20>       Flags: <unique><active>
|   CEH<1e>              Flags: <group><active>
|   CEH<1b>              Flags: <unique><active>
|   CEH<1d>              Flags: <unique><active>
|_  \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 0.58 seconds
```

### Using `net` tool on windows

#### View all available shares

```
net view \\<computername> /ALL
```

<figure><img src="../../.gitbook/assets/image (33).png" alt=""><figcaption><p>net view command results</p></figcaption></figure>

In the above command `<computername>`, is the name or IP address of a specific computer, the resources of which are to be displayed.

To view all available shares for the current host we can also use the share command.

```
net share
```

<figure><img src="../../.gitbook/assets/image (34).png" alt=""><figcaption></figcaption></figure>

#### Display all the shares in the domain

```
net view /domain 
```

#### Display all the shares on the specified domain.

```
net view /domain:<domain name>
```

**Listing Mapped Network Drives or available shares on the host**:

The net use command is used to list the shared folder/drive available on the Windows Server.

```
net use
```

<figure><img src="../../.gitbook/assets/image (30).png" alt=""><figcaption><p>The net use command is used to list the shared folder/drive available on the Windows Server.</p></figcaption></figure>

#### Mapping a network drive

```
net use [DriveLetter:] \\ComputerName\ShareName [/persistent:{yes | no}]
```

An example of this would be:

```
net use Z: \\Included\Share
net use Z: \\Included\Share /persistent:yes
```

#### Mapping with different credentials

```
net use Z: \\Server\SharedFolder /user:John secret123
```

#### Disconnect a mapped drive

```
net use Z: /delete
```

### Using the NetBIOS enumerator GUI tool on Windows

NetBIOS enumerator is a GUI tool on Windows which can be used to enumerate NetBIOS names and &#x20;

## Exploitation

